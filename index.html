<html >
  <head>
    <meta charset="UTF-8">
    <title>Omniflow Control Center</title>
        
      <link rel="stylesheet" href="http://alpha.exatronic.io/osaka1/controlcenter/public/css/stylecontrol.css">

  </head>

  <body>

      <div class="header-back">
      <div class="header">
            <a href="http://www.omniflow.pt">
                <img src="http://alpha.exatronic.io/osaka1/controlcenter/public/images/OmniF_logo.png" alt="Powered by Omniflow" style="height:40px;margin-left:3%;margin-top:15px">
            </a>
      </div>
      </div>
      
      <div style="height:100px"></div>
      <div class="container-header"><h1>Instantaneous Info</h1></div>
      <div class="container" id="instdataCont"></div>
      
      <div style="height:70px"></div>
      <div class="container-header"><h1>Configuration Info</h1></div>
      <div class="container" id="confdataCont"></div>
      
      <div style="height:70px"></div>
      <div class="container-header"><h1>Config Values</h1></div>
      <div class="container" id="confValuesCont">
       <form id="putvaluesform">
            <select name="putkey">
                <option value="T1">T1</option>
                <option value="T2">T2</option>
                <option value="T3">T3</option>
                <option value="V1">V1</option>
                <option value="V2">V2</option>
                <option value="V3">V3</option>
                <option value="DeltaV1">DeltaV1</option>
                <option value="DeltaV2">DeltaV2</option>
                <option value="DeltaV3">DeltaV3</option>
                <option value="POn">POn</option>
                <option value="PPir">PPir</option>
                <option value="P1">P1</option>
                <option value="P2">P2</option>
                <option value="ReleAuxMode">ReleAuxMode</option>
                <option value="ReleAuxVBatOn">ReleAuxVBatOn</option>
                <option value="ReleAuxVBatOff">ReleAuxVBatOff</option>
                <option value="ReleAuxPirTime">ReleAuxPirTime</option>
                <option value="ReleAuxTimerDay">ReleAuxTimerDay</option>
                <option value="ReleAuxTimerNight">ReleAuxTimerNight</option>
                <option value="RelePowerVBatOn">RelePowerVBatOn</option>
                <option value="RelePowerVBatOff">RelePowerVBatOff</option>
            </select> 
          
            <input type="number" name="putvalue" placeholder="value"/>
            <button onclick="return PutValues();">Submit</button>
          </form>
      </div>
      
      <div style="height:70px"></div>
      <div class="container-header"><h1>Functionalities</h1></div>
      <div class="container" id="functionalities" style="text-align:center">
      <div style="height:10px"></div>
        <button onclick="return LedsON();" style="width:49%">Leds Default</button>
        <button onclick="return LedsOFF();" style="width:49%; margin-right=0px">Leds OFF</button>
      <div style="height:10px"></div>
      </div>
      
      <div style="height:100px"></div>
      
      
      
      
      
      
    
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
      <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
      <script>
          
          function debug(message) {
                console.log(message);
            }
          
		  
		  localStorage.setItem('imei', '357976063980593');
		  
		  
        var imei = localStorage.getItem("imei");
        var login = localStorage.getItem("login");
        var pass = localStorage.getItem("pass");
        
        var instdata= null;
        var confdata= null;
          
          
          
          function GetInstData(){
              $.ajax({
                url: './scripts/getinstdata.php',
                type: 'POST',
                dataType: 'json',
                data: {imei:imei},
                success: function(data)
                { 
                    instdata = data;
                    displayInstData(); 
                },
                error: function(data) 
                { 
	           debug('InstData: Query Error');
                }
              });    
          }GetInstData();
          
          function displayInstData(){
              if(instdata != null){
                  var table = '<table>';
                  table+='<tr>';
                  table+='<td>State: '+instdata.State+'</td>';
                  table+='<td>Imei: '+instdata.imei+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Name: '+instdata.Name+'</td>';
                  table+='<td>Serial Number: '+instdata.SerialNumber+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Latitude: '+instdata.PositionLat+'</td>';
                  table+='<td>Longitude: '+instdata.PositionLng+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Version: '+instdata.Version+'</td>';
                  table+='<td>Revision: '+instdata.Revision+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Device Type: '+instdata.DeviceType+'</td>';
                  table+='<td></td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>VBat: '+instdata.VBat+'</td>';
                  table+='<td>TElec: '+instdata.TElec+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Led Intensity: '+instdata.IntensityLed+'</td>';
                  table+='<td>Current Total (A): '+comp2(instdata.CurrentLed)/1000+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<tr>';
                  table+='<td>PIR1 State: '+instdata.PIR1State+'</td>';
                  table+='<td>PIR2 State: '+instdata.PIR2State+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Load In: '+instdata.LoadIn+'</td>';
                  table+='<td>RelePower State: '+instdata.RelePower+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>Last Update: '+instdata.UpdateInstDate+'</td>';
                  table+='<td>Last Update: '+instdata.UpdateInstTime+'</td>';
                  table+='</tr>';
                  table+= '</table>';
                  table+="<button onclick='return UpdateInst();'>Update Data</button>";
                  
                  document.getElementById("instdataCont").innerHTML=table;
              }
          }
          
          function UpdateInst(){
                $.ajax({
                url: './scripts/updateinstdata.php',
                type: 'POST',
                dataType: 'json',
                data: {imei:imei},
                success: function(data)
                { 
                     var status=data["status"];
                     if(status!=1)
                     {
                        debug('UpdateInstData Error:'+status);
                     }
                },
                error: function(data) 
                { 
	           debug('UpdateInstData: Query Error');
                }
              });    
          }
          
          function GetConfData(){
              $.ajax({
                url: 'http://alpha.exatronic.io/osaka1/controlcenter/scripts/getconfdata.php',
                type: 'POST',
                dataType: 'json',
                data: {imei:imei},
                success: function(data)
                { 
                    confdata = data;
                    displayConfData(); 
                },
                error: function(data) 
                { 
	           debug('ConfData: Query Error');
                }
              });    
          }GetConfData();
          
          function displayConfData(){
              if(confdata != null){
                  var table = '<table>';
                  table+='<tr>';
                  table+='<td>T1: '+confdata.T1+'</td>';
                  table+='<td>T2: '+confdata.T2+'</td>';
                  table+='<td>T3: '+confdata.T3+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>V1: '+confdata.V1+'</td>';
                  table+='<td>V2: '+confdata.V2+'</td>';
                  table+='<td>V3: '+confdata.V3+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>DeltaV1: '+confdata.DeltaV1+'</td>';
                  table+='<td>DeltaV2: '+confdata.DeltaV2+'</td>';
                  table+='<td>DeltaV3: '+confdata.DeltaV3+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>POn: '+confdata.POn+'</td>';
                  table+='<td>PPir: '+confdata.PPir+'</td>';
                  table+='<td></td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>P1: '+confdata.P1+'</td>';
                  table+='<td>P2: '+confdata.P2+'</td>';
                  table+='<td></td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>ReleAuxMode: '+confdata.ReleAuxMode+'</td>';
                  table+='<td>ReleAuxVBatOn: '+confdata.ReleAuxVBatOn+'</td>';
                  table+='<td>ReleAuxVBatOff: '+confdata.ReleAuxVBatOff+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>ReleAuxPirTime: '+confdata.ReleAuxPirTime+'</td>';
                  table+='<td>ReleAuxTimerDay: '+confdata.ReleAuxTimerDay+'</td>';
                  table+='<td>ReleAuxTimerNight: '+confdata.ReleAuxTimerNight+'</td>';
                  table+='</tr>';
                  table+='<tr>';
                  table+='<td>RelePowerVBatOn: '+confdata.RelePowerVBatOn+'</td>';
                  table+='<td>RelePowerVBatOff: '+confdata.RelePowerVBatOff+'</td>';
                  table+='<td></td>';
                  table+='<tr>';
                  table+='<td>Last Update: '+confdata.UpdateConfDate+'</td>';
                  table+='<td>Last Update: '+confdata.UpdateConfTime+'</td>';
                  table+='<td></td>';
                  table+='</tr>';
                  table+= '</table>';
                  table+="<button onclick='return UpdateConf();'>Update Data</button>";
                  
                  document.getElementById("confdataCont").innerHTML=table;
              }
          }
          
          function UpdateConf()
          {
                $.ajax({
                url: 'http://alpha.exatronic.io/osaka1/controlcenter/scripts/updateconfdata.php',
                type: 'POST',
                dataType: 'json',
                data: {imei:imei},
                success: function(data)
                { 
                     var status=data["status"];
                     if(status!=1)
                     {
                        debug('UpdateConfData Error:'+status);
                     }
                },
                error: function(data) 
                { 
	           debug('UpdateConfData: Query Error');
                }
              });    
          }
          
          function PutValues(){
                var key = document.forms["putvaluesform"]["putkey"].value;
                var value = document.forms["putvaluesform"]["putvalue"].value;
                if(value == 0)
                        value='00';

                $.ajax({
                url: 'http://alpha.exatronic.io/osaka1/controlcenter/scripts/putvalues.php',
                type: 'POST',
                dataType: 'json',
                data: {imei:imei, key:key, value},
                success: function(data)
                { 
                     var status = data["status"];
                     if(status!=1)
                     {
                        debug('PutValues Error:'+status);
                     }
                },
                error: function(data) 
                { 
	           debug('PutValues: Query Error');
                }
              });    
              return false;
          }
          
          function PutValuesKeyValue(pkey,pvalue)
          {
                $.ajax({
                url: 'http://alpha.exatronic.io/osaka1/controlcenter/scripts/putvalues.php',
                type: 'POST',
                dataType: 'json',
                data: {imei:imei,key:pkey,value:pvalue},
                success: function(data)
                { 
                     var status = data["status"];
                     if(status!=1)
                     {
                        debug('PutValues Error:'+status);
                     }
                },
                error: function(data) 
                { 
	           debug('PutValues: Query Error');
                }
              });
              return false;
          }
          
          function comp2(num){
            if(num>32767)
            {
                return -((~num+1)+65536);
            }
            return num;
          }
          
          function LedsON(){
                PutValuesKeyValue('POn','65');
                PutValuesKeyValue('PPir','65');
                PutValuesKeyValue('P1','20');
                PutValuesKeyValue('P2','15');
                /*
                websocket.send( '+put[POn,65]' );
                setTimeout(function(){websocket.send( '+put[PPir,65]' )},100);
                setTimeout(function(){websocket.send( '+put[P1,20]' )},200);
                setTimeout(function(){websocket.send( '+put[P2,15]' )},300);
                */
          }
          
          function LedsOFF(){
                PutValuesKeyValue('P2','00');
                PutValuesKeyValue('P1','00');
                PutValuesKeyValue('PPir','00');
                PutValuesKeyValue('POn','00');
                /*
                websocket.send( '+put[P2,0]' );
                setTimeout(function(){websocket.send( '+put[P1,0]' )},100);
                setTimeout(function(){websocket.send( '+put[PPir,0]')},200);
                setTimeout(function(){websocket.send( '+put[POn,0]')},300);
                */
          }
          //auto inst and conf data update
          setInterval(function() {
              GetInstData();
              setTimeout(GetConfData,5000);
            }, 10000);
          
          
      </script>
  </body>
</html>
